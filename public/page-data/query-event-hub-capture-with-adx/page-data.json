{"componentChunkName":"component---src-components-post-layout-js","path":"/query-event-hub-capture-with-adx/","result":{"data":{"mdx":{"id":"0a4f8767-c9be-5b8c-992e-df26cdc139b7","body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Querying Event Hub Capture files with Azure Data Explorer\",\n  \"date\": \"2021-01-31T00:00:00.000Z\",\n  \"published\": true,\n  \"tags\": [\"Azure Data Explorer\", \"Event Hub\", \"Kusto\"],\n  \"description\": \"Creating and querying external tables on Event Hub Capture avro files with Azure Data Explorer\",\n  \"toc\": false,\n  \"seoImage\": \"og-query-event-hub-capture-with-adx.png\",\n  \"featuredImage\": \"./featured-image.png\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://docs.microsoft.com/en-us/azure/data-explorer/data-explorer-overview\"\n  }, \"Azure Data Explorer\"), \" (ADX) has built-in Data Ingestion capabilities \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://docs.microsoft.com/en-us/azure/data-explorer/ingest-data-event-hub\"\n  }, \"from Event Hub\"), \" - where streaming data is continuously ingested into a \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://docs.microsoft.com/en-us/azure/data-explorer/ingest-data-event-hub\"\n  }, \"Target Table\"), \" on an ADX database. We can also take advantage of external tables on ADX to \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"(https://docs.microsoft.com/en-us/azure/data-explorer/data-lake-query-data)\"\n  }, \"query data on Azure Data Lake\"), \" - in particular, the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"avro\"), \" files from \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-capture-overview\"\n  }, \"Event Hub Capture\"), \".\"), mdx(\"p\", null, \"We looked at how to process Capture files with Auto Loader earlier \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"../event-hub-capture-with-autoloader/\"\n  }, \"here\"), \". This article presents an alternative approach that allows us to query the same set of \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"avro\"), \" files \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, mdx(\"em\", {\n    parentName: \"strong\"\n  }, \"in place\")), \" using \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://docs.microsoft.com/en-us/azure/data-explorer/kusto/query/\"\n  }, mdx(\"code\", {\n    parentName: \"a\",\n    \"className\": \"language-text\"\n  }, \"KQL\")), \" instead - with the added benefit of not having to specify the payload schema or move data from the data lake.\"), mdx(Callout, {\n    mdxType: \"Callout\"\n  }, mdx(\"p\", null, \"\\uD83D\\uDCA1 The sample Producer and payload details are available \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"../event-hub-capture-with-autoloader/#producer\"\n  }, \"here\"), \".\")), mdx(\"p\", null, \"Before we structure our \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"KQL\"), \" query to define the external table, we make a note of the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Time window (minutes)\"), \" of the Event Hub Capture Frequency - which in our case is \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"every 1 minute\"), \":\\n\", mdx(\"figure\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-figure\",\n    \"style\": {}\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"figure\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"775px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/77b9a8965621ad0a69abdc7c649e6715/49bb6/capture-semantics.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"35.833333333333336%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABcRAAAXEQHKJvM/AAABG0lEQVQoz52QS07DMBCGc38kLsIJOANigcQKUFVg1NhxbLexnYfjmWHiFhCbLlh8/n/b89I0jESMSNZZ0lpXlFI/2raKuq4jVf/O7+e7+hO3ac6ZmtuHnm8eNZfoWXcdSyJLAEtAZfNS4HxXmjvrOYRQGYaBw0b1gde1cPMUC919BLp/7mlIEzHLxHL8lwanRMFafgNDx9OJ46X7pimlSoyxaoiJ51y4lCJbQploFY9cxKeV6vYaGRWd95jCCadpwnEcr7LFHA4t7vfv+AmAO+Vxpwd8PU7oVsImSHdjTN3HNoUk8DzPV1mWRfjVLDpKXpoXbl50BNUZMEYLBpyzggNnHfR9D7a34L0HKQRSABbR6i/6/Z7zArIK+AJXJRZVa4T1JgAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Capture Frequency\",\n    \"title\": \"Capture Frequency\",\n    \"src\": \"/static/77b9a8965621ad0a69abdc7c649e6715/49bb6/capture-semantics.png\",\n    \"srcSet\": [\"/static/77b9a8965621ad0a69abdc7c649e6715/9aebd/capture-semantics.png 480w\", \"/static/77b9a8965621ad0a69abdc7c649e6715/49bb6/capture-semantics.png 775w\"],\n    \"sizes\": \"(max-width: 775px) 100vw, 775px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \"), \"\\n    \", mdx(\"figcaption\", {\n    parentName: \"figure\",\n    \"className\": \"gatsby-resp-image-figcaption\"\n  }, \"Capture Frequency\"), \"\\n  \")), mdx(\"p\", null, \"We begin with an existing ADX Database (setup instructions \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://docs.microsoft.com/en-us/azure/data-explorer/create-cluster-database-resource-manager\"\n  }, \"here\"), \"), and create an \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"external table\"), \" on top our Data Lake using the command below:\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"sql\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"className\": \"language-sql\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sql\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// Create External Table\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"create\"), \" external \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"table\"), \" your_external_table_name \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"SequenceNumber:long\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n                                         \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"Offset\"), \":string\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n                                         EnqueuedTimeUtc:string\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n                                         SystemProperties:dynamic\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n                                         Properties:dynamic\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n                                         Body: dynamic\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \"\\nkind\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \"adl\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"partition\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"by\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"EHPartition:string\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" Capture_timestamp:\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"datetime\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \"\\npathformat \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"EHPartition \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"\\\"/\\\"\"), \" datetime_pattern\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"\\\"yyyy/MM/dd/HH/mm\\\"\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" Capture_timestamp\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \"\\n\\ndataformat\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \"apacheavro\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"\\n   h\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token variable\"\n  }, \"@'abfss://<your--container>@<your--storage--account>.dfs.core.windows.net/<your--event--hub--namespace>/<your--event--hub>;<your--storage--account--key>'\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\")))), mdx(\"p\", null, \"Note a couple takeaways from here:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"We specify the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"avro\"), \" schema (and not the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"JSON\"), \" payload schema that our application dictates) when creating the External Table.\"), mdx(\"p\", {\n    parentName: \"li\"\n  }, \"The \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"avro\"), \" schema isn't likely to change as it's the same for all Event Hubs - meaning we only need to do this once.\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"We specify the following \\\"\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://docs.microsoft.com/en-us/azure/data-explorer/kusto/management/external-tables-azurestorage-azuredatalake#virtual-columns\"\n  }, \"Virtual columns\"), \"\\\" via \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"pathformat\"), \", which also defines the Capture Frequency down to minutes granularity (i.e. in alignment with how our Capture is configured).\"), mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"EHPartition\"), \": Event Hub Partition\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"Capture_timestamp\"), \": When capture was performed on ADLS\")), mdx(\"p\", {\n    parentName: \"li\"\n  }, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Note:\"), \" The naming convention here is arbitrary.\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"We specify the external file format as \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"avro\"), \" via \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"dataformat=apacheavro\")))), mdx(\"p\", null, mdx(\"figure\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-figure\",\n    \"style\": {}\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"figure\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"1920px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/e841320798050379b39acab3e49c84fb/f6c02/create-table.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"35.208333333333336%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABcRAAAXEQHKJvM/AAABeklEQVQoz2WRbU/bMBSF8ye2ksQJdWLn1Xac8VKWUqgG09oONlahwiZVSPD/f8A+7J65aSSY9uHRufb1OdeWvWCsfrPEgHFNjCtyNTHRUFSfUWxnFOmOQmEpYAXxtKGx6498SaNA0kGQ/YPPcvIiFyaqE0ryFmne7Grk7QzzxxdcPmxhFyvw8xXUl3uoxT2yqzuUn9fIPn0Hn39DMr8Fv7jp9fD0Ct5BXNM7VmIUVfR+R5hTkB3RbPNM5+sHOlouyRlILjaUrx5JLjdk7rZU3f6i/OtPMj+2/bpZP5G4vCEvkQq1su52HyDKYySZRtZ0aOcr2NkUcnKBWE/BxspRw49K+KxwWvR1MOAPeGluydgJ9Nk1le6porQozUfI6hSibpCaFonpIHWHtDiGf6gc9f+4ge4/4MWiRWE7KqfX4GaCMFUIxQ4NJsyA6veZ1Igyg0iavQ6wVPehfWDI9Z/ImQJeEXOmOGv2BvHGKPfBfa8foPe94VyYvAb+BUt20sFMIBfkAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Create External Table\",\n    \"title\": \"Create External Table\",\n    \"src\": \"/static/e841320798050379b39acab3e49c84fb/ac7a9/create-table.png\",\n    \"srcSet\": [\"/static/e841320798050379b39acab3e49c84fb/9aebd/create-table.png 480w\", \"/static/e841320798050379b39acab3e49c84fb/a91f8/create-table.png 960w\", \"/static/e841320798050379b39acab3e49c84fb/ac7a9/create-table.png 1920w\", \"/static/e841320798050379b39acab3e49c84fb/f6c02/create-table.png 2059w\"],\n    \"sizes\": \"(max-width: 1920px) 100vw, 1920px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \"), \"\\n    \", mdx(\"figcaption\", {\n    parentName: \"figure\",\n    \"className\": \"gatsby-resp-image-figcaption\"\n  }, \"Create External Table\"), \"\\n  \")), mdx(\"p\", null, \"And we see the following confirmation:\\n\", mdx(\"figure\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-figure\",\n    \"style\": {}\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"figure\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"1505px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/6b1c59eb797fc442497f85ed9f0aaa09/2ae13/create-table-return.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"26.041666666666668%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAvklEQVQY032Q224EIQxD+f+/7MNqK81quIRbEsBN6c5WrdQ+HNkYLIW4+8Mj5QIqFbk2o5oviJSf/gsf486u82cnZEIgsruEh484PcH5SLi93SxI+6GOAVFF6/0Fi2ytrf3IVQfGnOjMkKGgkOAiFbzfT8QiqLoMbNr45sp+U2Rtrl4273zKOI6AI2SEKvCZ4QsjmgbjzB2p6bM8/2GB+oBroja6oNu32Hyz8TsLxJSN1nmvYK2FueafLENsXR+KC4VREYz4jwAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Create External Table Confirmation\",\n    \"title\": \"Create External Table Confirmation\",\n    \"src\": \"/static/6b1c59eb797fc442497f85ed9f0aaa09/2ae13/create-table-return.png\",\n    \"srcSet\": [\"/static/6b1c59eb797fc442497f85ed9f0aaa09/9aebd/create-table-return.png 480w\", \"/static/6b1c59eb797fc442497f85ed9f0aaa09/a91f8/create-table-return.png 960w\", \"/static/6b1c59eb797fc442497f85ed9f0aaa09/2ae13/create-table-return.png 1505w\"],\n    \"sizes\": \"(max-width: 1505px) 100vw, 1505px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \"), \"\\n    \", mdx(\"figcaption\", {\n    parentName: \"figure\",\n    \"className\": \"gatsby-resp-image-figcaption\"\n  }, \"Create External Table Confirmation\"), \"\\n  \")), mdx(\"p\", null, \"We can list the \\\"External table artifacts\\\" (i.e. the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"avro\"), \" files that make up our External Table) and inferred Partitions via the following command:\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"sql\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"className\": \"language-sql\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sql\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"show\"), \" external \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"table\"), \" your_external_table_name artifacts\"))), mdx(\"p\", null, mdx(\"figure\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-figure\",\n    \"style\": {}\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"figure\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"1920px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/c079ad9aa9babe4fb8b178bf891cd5b9/e4d48/inferred-partitions.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"30.208333333333332%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABcRAAAXEQHKJvM/AAABHElEQVQY04WQy3KEIBBF/f/vyyKrqYwDoiDgEwSkb1onWWQVqFO3X9V1oTF+ppgSnedJpRQql97xrxbKOVNiLr3yGBPZxdKyLrSFg/Z9JzvvtHDc+HmBHkcMxmB07o21MFy71HqPeBwIMWLbd1ju69HATxMc9658mmewISysjfcTvcSLvp5P6jp1I6QkKQUppUhrTbUSAaCcMhltqO97kl3Hc4LnJHnn7n6MkZpxXiFkj0crIIcerZIQvWK6O3/pAVMI8IHdrTyrNXp2PrI7bR0MM68bciWEI6HZjoyHcvhoNcQWMXBx4JoMCYY1n+UPqRSUeqJSRa0/cHzyI7Z4oIm5YOIl4x7RrQc+fUK7ZahQ4NKJ96F/uW7gv/4GxkDMvass/rEAAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"External Table Artifacts\",\n    \"title\": \"External Table Artifacts\",\n    \"src\": \"/static/c079ad9aa9babe4fb8b178bf891cd5b9/ac7a9/inferred-partitions.png\",\n    \"srcSet\": [\"/static/c079ad9aa9babe4fb8b178bf891cd5b9/9aebd/inferred-partitions.png 480w\", \"/static/c079ad9aa9babe4fb8b178bf891cd5b9/a91f8/inferred-partitions.png 960w\", \"/static/c079ad9aa9babe4fb8b178bf891cd5b9/ac7a9/inferred-partitions.png 1920w\", \"/static/c079ad9aa9babe4fb8b178bf891cd5b9/e4d48/inferred-partitions.png 2009w\"],\n    \"sizes\": \"(max-width: 1920px) 100vw, 1920px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \"), \"\\n    \", mdx(\"figcaption\", {\n    parentName: \"figure\",\n    \"className\": \"gatsby-resp-image-figcaption\"\n  }, \"External Table Artifacts\"), \"\\n  \")), mdx(\"p\", null, \"And finally, we can query the contents of our Event Hub Capture \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"JSON\"), \" payloads without having to specify the schema, thanks to the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://docs.microsoft.com/en-us/azure/data-explorer/kusto/query/bag-unpackplugin\"\n  }, mdx(\"code\", {\n    parentName: \"a\",\n    \"className\": \"language-text\"\n  }, \"bag_unpack()\")), \" Kusto command:\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"sql\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"className\": \"language-sql\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sql\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// Query External Table\"), \"\\nexternal_table\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"\\\"your_external_table_name\\\"\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"|\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"where\"), \" EHPartition  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token number\"\n  }, \"0\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// Filter on Event Hub Partition\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"|\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"where\"), \" Capture_timestamp \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"between\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"ago\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token number\"\n  }, \"10\"), \"m\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"now\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// Filter on data captured for the last 10 minutes\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"|\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"limit\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token number\"\n  }, \"100\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"|\"), \" project EHPartition\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" SequenceNumber\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"Offset\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" EnqueuedTimeUtc\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" Capture_timestamp\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" Body  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// \\\"SELECT\\\" statement\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"|\"), \" evaluate bag_unpack\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"Body\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// Explode JSON payload\")))), mdx(\"p\", null, mdx(\"figure\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-figure\",\n    \"style\": {}\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"figure\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"1920px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/35062e5ea789b2ebb9f3e5780f9d5f28/e4d48/querying-payload.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"30.208333333333332%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABcRAAAXEQHKJvM/AAABJ0lEQVQY00VQi07EIBDs//+dMUZjvJjo2RaOlve73XHbOyNkMuwAswPDbdHknKeUEuVSqNZKKWcqvM7M+cG1NWq9M9pDK7Q6vhsCOR9IGU8hFRpciGjbhhAjZikglcLPOEHIGyYxYxSS9zKmecb39XruqXXFzzRCa3NqPgTk2qDUgsGGTFooklLTau5J2Zy7ZYq8Nj6Sz40s82od14ESJzyTxUSLsRRLJV863VZNg00Fb5crnj8nvI4r3oVG3nYAdJ9ESLUjMg52uWIyGcIV5NZR+sZ6Qz9emTKGJRa8CIsnGfDhKy6RL22EnY36H/Yd9xY4jb9Mxeg7/gedOIwHzwkbJ0q1QlsH6wMU/422HosxDHseXFiT/EdHHVOEMfo8e2ip1DPtwb8djM12QXr/pAAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Querying Capture payload\",\n    \"title\": \"Querying Capture payload\",\n    \"src\": \"/static/35062e5ea789b2ebb9f3e5780f9d5f28/ac7a9/querying-payload.png\",\n    \"srcSet\": [\"/static/35062e5ea789b2ebb9f3e5780f9d5f28/9aebd/querying-payload.png 480w\", \"/static/35062e5ea789b2ebb9f3e5780f9d5f28/a91f8/querying-payload.png 960w\", \"/static/35062e5ea789b2ebb9f3e5780f9d5f28/ac7a9/querying-payload.png 1920w\", \"/static/35062e5ea789b2ebb9f3e5780f9d5f28/e4d48/querying-payload.png 2009w\"],\n    \"sizes\": \"(max-width: 1920px) 100vw, 1920px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \"), \"\\n    \", mdx(\"figcaption\", {\n    parentName: \"figure\",\n    \"className\": \"gatsby-resp-image-figcaption\"\n  }, \"Querying Capture payload\"), \"\\n  \")), mdx(\"p\", null, \"And we have our original payloads back, along with the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://docs.microsoft.com/en-us/dotnet/api/microsoft.servicebus.messaging.eventdata?view=azure-dotnet#properties\"\n  }, mdx(\"code\", {\n    parentName: \"a\",\n    \"className\": \"language-text\"\n  }, \"EventData\")), \" properties in a queryable format.\"), mdx(Callout, {\n    mdxType: \"Callout\"\n  }, mdx(\"p\", null, \"\\uD83D\\uDE80 While this is handy, querying external tables will probably not be as performant as querying the physically ingested Event Hub data using the methods described \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://docs.microsoft.com/en-us/azure/data-explorer/ingest-data-event-hub\"\n  }, \"here\"), \".\")));\n}\n;\nMDXContent.isMDXComponent = true;","frontmatter":{"title":"Querying Event Hub Capture files with Azure Data Explorer","date":"January 31st 2021","datetime":"2021-01-31T00:00:00.000Z","description":"Creating and querying external tables on Event Hub Capture avro files with Azure Data Explorer","toc":false},"fields":{"slug":"/query-event-hub-capture-with-adx/"},"excerpt":"Azure Data Explorer  (ADX) has built-in Data Ingestion capabilities  from Event Hub  - where streaming data is continuously ingested into aâ€¦","tableOfContents":{},"timeToRead":1},"ogImage":null},"pageContext":{"id":"0a4f8767-c9be-5b8c-992e-df26cdc139b7","ogImageSlug":"og-query-event-hub-capture-with-adx.png"}},"staticQueryHashes":["1233398279","1450367068"]}